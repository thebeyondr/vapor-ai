---
phase: 03-model-discovery
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - lib/huggingface/search.ts
  - app/(dashboard)/training/actions.ts
  - app/(dashboard)/training/components/model-search.tsx
  - app/(dashboard)/training/components/search-results.tsx
  - app/(dashboard)/training/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can type a search query and see HuggingFace model results after debounced delay"
    - "Search shows loading state while fetching"
    - "Search gracefully falls back to cached/filtered data if HuggingFace API is unavailable"
  artifacts:
    - path: "lib/huggingface/search.ts"
      provides: "HuggingFace model search with caching and fallback"
      exports: ["searchHuggingFaceModels"]
    - path: "app/(dashboard)/training/actions.ts"
      provides: "Server Action for model search"
      exports: ["searchModels"]
    - path: "app/(dashboard)/training/components/model-search.tsx"
      provides: "Client component with debounced search input"
      min_lines: 30
    - path: "app/(dashboard)/training/components/search-results.tsx"
      provides: "Search results grid rendering ModelCards"
      min_lines: 20
  key_links:
    - from: "app/(dashboard)/training/components/model-search.tsx"
      to: "app/(dashboard)/training/actions.ts"
      via: "useDebouncedCallback calling searchModels Server Action"
      pattern: "searchModels"
    - from: "app/(dashboard)/training/actions.ts"
      to: "lib/huggingface/search.ts"
      via: "Server Action delegates to search function"
      pattern: "searchHuggingFaceModels"
    - from: "lib/huggingface/search.ts"
      to: "lib/huggingface/liquid-lfm.ts"
      via: "Falls back to filtering static LIQUID_LFMS on API error"
      pattern: "LIQUID_LFMS"
---

<objective>
Add debounced model search to the training page via HuggingFace API with graceful fallback.

Purpose: Users can discover models beyond the curated Liquid LFM set by searching the HuggingFace ecosystem. Search must feel snappy (debounced) and never break (fallback).
Output: Working search bar on training page with Server Action-backed HuggingFace search.
</objective>

<execution_context>
@/home/wraith/.claude/get-shit-done/workflows/execute-plan.md
@/home/wraith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-model-discovery/03-RESEARCH.md
@.planning/phases/03-model-discovery/03-01-SUMMARY.md
@lib/huggingface/types.ts
@lib/huggingface/client.ts
@lib/huggingface/liquid-lfm.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Search logic and Server Action</name>
  <files>lib/huggingface/search.ts, app/(dashboard)/training/actions.ts</files>
  <action>
Create `lib/huggingface/search.ts`:
- Export `searchHuggingFaceModels(query: string): Promise<{ success: boolean, data: ModelInfo[], error?: string }>`
- Use `listModels` from `@huggingface/hub` with `search: { query }` and `limit: 20`
- Map HuggingFace results to `ModelInfo` type (infer modality from pipeline_tag or tags if possible, default to "text")
- On error (including 429 rate limit): fall back to filtering `LIQUID_LFMS` by query string (case-insensitive match on name, description, architecture)
- Log errors with `console.warn` for debugging
- Use optional `HUGGINGFACE_TOKEN` env var for auth (same pattern as client.ts)

Create `app/(dashboard)/training/actions.ts`:
- Add `"use server"` directive at top
- Export `searchModels(query: string)` Server Action
- Validate query with zod: string, min 1 char, max 100 chars. Return `{ error: "Invalid search query" }` on validation failure
- Call `searchHuggingFaceModels(query)` and return result
- Handle empty query by returning empty array (don't call API for blank input)
  </action>
  <verify>
`pnpm build` succeeds. Server Action is importable without errors.
  </verify>
  <done>Search function queries HuggingFace API with fallback, Server Action validates and delegates.</done>
</task>

<task type="auto">
  <name>Task 2: Debounced search UI components</name>
  <files>app/(dashboard)/training/components/model-search.tsx, app/(dashboard)/training/components/search-results.tsx, app/(dashboard)/training/page.tsx</files>
  <action>
Create `app/(dashboard)/training/components/model-search.tsx` ("use client"):
- Import `useDebouncedCallback` from `use-debounce`, `useTransition` and `useState` from React
- Import `searchModels` from `../actions`
- Render ShadCN Input with search icon (lucide Search), placeholder "Search HuggingFace models..."
- Debounce at 300ms. On debounced change: `startTransition(async () => { const result = await searchModels(value); setResults(result) })`
- Show loading skeleton (3 placeholder cards) during `isPending`
- When results exist, render SearchResults component
- When query is cleared, hide results (show nothing, curated section remains visible)
- Include a clear button (X icon) when input has value

Create `app/(dashboard)/training/components/search-results.tsx`:
- Props: `results: ModelInfo[], query: string`
- Render header: "Search results for '{query}'" with result count
- Render ModelCard grid (same responsive grid as curated section: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`)
- If results empty: show "No models found for '{query}'" message with suggestion to try different keywords
- If error in results: show friendly error message

Update `app/(dashboard)/training/page.tsx`:
- Replace the placeholder #model-search div with the ModelSearch client component
- Add a ShadCN Separator between curated section and search section
- Add section heading "Search All Models" above the search bar
  </action>
  <verify>
`pnpm build` succeeds. Visit /training — search input visible. Type "bert" — after 300ms debounce, results appear (from HuggingFace API or fallback). Clear input — results disappear. Loading skeletons show during fetch.
  </verify>
  <done>Users can search HuggingFace models with debounced input, see loading states, and get results or graceful error messages. Search never breaks the page.</done>
</task>

</tasks>

<verification>
- `pnpm build` passes with no errors
- Search input on /training page is functional
- Typing triggers debounced search (not on every keystroke)
- Results render in model card grid
- If HuggingFace API is down, fallback filters curated models
- Loading skeleton displays during search
- Empty/error states handled gracefully
</verification>

<success_criteria>
User can type a query in the search bar on /training, see a loading state, then see HuggingFace model results in card format. If API fails, fallback results from curated data appear instead. Clearing search returns to curated-only view.
</success_criteria>

<output>
After completion, create `.planning/phases/03-model-discovery/03-02-SUMMARY.md`
</output>
