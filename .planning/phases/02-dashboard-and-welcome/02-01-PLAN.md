---
phase: 02-dashboard-and-welcome
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/seed.ts
  - lib/db/queries.ts
  - app/(dashboard)/page.tsx
  - app/(dashboard)/components/dashboard-metrics.tsx
  - app/(dashboard)/components/recent-jobs-list.tsx
  - app/(dashboard)/components/status-badge.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "Dashboard displays summary cards showing active training jobs, deployed models, and recent activity"
    - "Dashboard shows recent training jobs with status badges (queued/running/complete/failed)"
    - "User can click Start New Training CTA to navigate to training config page"
  artifacts:
    - path: "app/(dashboard)/page.tsx"
      provides: "Dashboard Server Component with parallel data fetching"
      contains: "Promise.all"
    - path: "app/(dashboard)/components/dashboard-metrics.tsx"
      provides: "Summary metric cards grid"
      contains: "Card"
    - path: "app/(dashboard)/components/recent-jobs-list.tsx"
      provides: "Recent training jobs list with status badges"
      contains: "StatusBadge"
    - path: "app/(dashboard)/components/status-badge.tsx"
      provides: "Accessible status badge component (color + icon + text)"
      contains: "statusConfig"
    - path: "lib/db/queries.ts"
      provides: "Cached database query functions"
      exports: ["getRecentJobs", "getJobCounts"]
    - path: "scripts/seed.ts"
      provides: "Database seed script with faker.js mock data"
      contains: "faker"
  key_links:
    - from: "app/(dashboard)/page.tsx"
      to: "lib/db/queries.ts"
      via: "Server Component import"
      pattern: "import.*from.*queries"
    - from: "app/(dashboard)/components/recent-jobs-list.tsx"
      to: "app/(dashboard)/components/status-badge.tsx"
      via: "StatusBadge component"
      pattern: "StatusBadge"
    - from: "app/(dashboard)/page.tsx"
      to: "/training"
      via: "Start New Training link"
      pattern: "href.*training"
---

<objective>
Build the dashboard landing page with summary metric cards, recent training jobs list with status badges, and a "Start New Training" CTA. Seed the database with realistic mock data using faker.js.

Purpose: Users see a functional, data-driven dashboard as the first thing when they visit Vapor. This establishes the app as a real platform, not a placeholder.
Output: Dashboard page with live database metrics, seeded test data, and navigation CTA.
</objective>

<execution_context>
@/home/wraith/.claude/get-shit-done/workflows/execute-plan.md
@/home/wraith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-and-welcome/02-RESEARCH.md
@lib/db/schema.ts
@lib/db/client.ts
@app/(dashboard)/page.tsx
@app/(dashboard)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies, create seed script and database query layer</name>
  <files>
    package.json
    scripts/seed.ts
    lib/db/queries.ts
  </files>
  <action>
    1. Install ShadCN components and faker.js:
       - `pnpm dlx shadcn@latest add card badge` (Dialog added in Plan 02)
       - `pnpm add -D @faker-js/faker`

    2. Create `scripts/seed.ts` — Database seed script using faker.js:
       - Import faker, db client, schema, and dotenv (same pattern as scripts/test-db.ts)
       - Generate 15-20 training jobs with realistic data:
         - name: faker.company.catchPhrase() or similar
         - status: weighted distribution — ~3 queued, ~4 running, ~8 complete, ~2 failed
         - modelName: randomly pick from ["LFM-1B", "LFM-3B", "LFM-Nano", "LFM-7B-Vision", "LFM-Audio-1B"]
         - epochs: faker.number.int({ min: 5, max: 50 })
         - learningRate: faker.number.float({ min: 0.0001, max: 0.01, fractionDigits: 4 })
         - createdAt: faker.date.recent({ days: 14 })
       - Use faker.seed(42) for deterministic output
       - Clear existing training_jobs before inserting (DELETE all first)
       - Add "db:seed" script to package.json: `"db:seed": "tsx scripts/seed.ts"`

    3. Run seed: `pnpm db:seed`

    4. Create `lib/db/queries.ts` — Cached database query functions:
       - Import `cache` from 'react', `db` from './client', schema, and drizzle operators (eq, desc, count, sql)
       - `getJobCounts()`: Returns `{ active: number, completed: number, failed: number, total: number }` using parallel count queries with Promise.all, grouped by status
       - `getRecentJobs(limit = 5)`: Returns recent training jobs ordered by createdAt desc
       - Wrap both with React `cache()` for request deduplication
  </action>
  <verify>
    - `pnpm db:seed` runs without errors and logs inserted row count
    - `lib/db/queries.ts` compiles: `pnpm exec tsc --noEmit lib/db/queries.ts` (or verify via next build)
  </verify>
  <done>Database has 15-20 seeded training jobs; query layer exports getJobCounts and getRecentJobs functions wrapped in React cache</done>
</task>

<task type="auto">
  <name>Task 2: Build dashboard page with metrics cards, recent jobs list, and CTA</name>
  <files>
    app/(dashboard)/page.tsx
    app/(dashboard)/components/dashboard-metrics.tsx
    app/(dashboard)/components/status-badge.tsx
    app/(dashboard)/components/recent-jobs-list.tsx
  </files>
  <action>
    1. Create `app/(dashboard)/components/status-badge.tsx` — Server Component:
       - Define Status type: 'queued' | 'running' | 'complete' | 'failed'
       - Create statusConfig object mapping each status to: label, variant (Badge variant), className (light + dark mode colors), icon (from lucide-react: Clock for queued, Loader2 for running with animate-spin, CheckCircle2 for complete, XCircle for failed)
       - Export StatusBadge component rendering Badge with icon + text (accessible: color + icon + text per WCAG)

    2. Create `app/(dashboard)/components/dashboard-metrics.tsx` — Server Component:
       - Accept props: `{ activeJobs: number, completedJobs: number, failedJobs: number, totalJobs: number }`
       - Render 3-column responsive grid (`grid gap-4 md:grid-cols-3`)
       - Cards:
         - "Active Training" — Activity icon, activeJobs count, "Currently running" subtitle
         - "Completed" — CheckCircle2 icon, completedJobs count, "Total successful" subtitle
         - "Total Jobs" — BarChart3 icon, totalJobs count, "All time" subtitle
       - Use ShadCN Card, CardHeader, CardTitle, CardContent
       - Each card header has icon on right side (flex row justify-between)

    3. Create `app/(dashboard)/components/recent-jobs-list.tsx` — Server Component:
       - Accept props: `{ jobs: TrainingJob[] }` (infer type from schema using `typeof trainingJobs.$inferSelect`)
       - Render a Card wrapping a simple table/list of recent jobs
       - Each row shows: job name, model name, StatusBadge, relative time (format createdAt as "2 hours ago" or similar using simple date math — no external library needed)
       - If jobs array is empty, show empty state: "No training jobs yet" with a link to /training
       - Below the list, add a "View All Jobs" link (for now, links to /training)

    4. Update `app/(dashboard)/page.tsx` — Convert to async Server Component:
       - Import getJobCounts, getRecentJobs from lib/db/queries
       - Fetch data with `const [counts, recentJobs] = await Promise.all([getJobCounts(), getRecentJobs(5)])`
       - Render page structure:
         - Header section: "Dashboard" h1, subtitle "Monitor your training jobs and deployments"
         - "Start New Training" Button as Link to /training (use Next.js Link + ShadCN Button with asChild, prominent placement in header row)
         - DashboardMetrics component with counts
         - RecentJobsList component with recentJobs
       - Add spacing with `space-y-8 p-6`

    5. Verify the build compiles: `pnpm build` (should pass with no errors)
  </action>
  <verify>
    - `pnpm build` succeeds
    - Visit http://localhost:3000 — dashboard shows metric cards with real counts from seeded data
    - Recent jobs list shows 5 jobs with colored status badges
    - "Start New Training" button navigates to /training page
  </verify>
  <done>Dashboard page displays 3 metric cards with live database counts, 5 recent training jobs with accessible status badges (color + icon + text), and a prominent "Start New Training" CTA linking to /training</done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds with no TypeScript errors
2. Dashboard page renders at / with metric cards showing real counts
3. Recent jobs show status badges with correct colors and icons
4. "Start New Training" navigates to /training
5. Database contains seeded mock data
</verification>

<success_criteria>
- Dashboard is a functional Server Component fetching real data from Neon via Drizzle
- 3 metric cards display active, completed, and total job counts
- Recent jobs list shows 5 jobs with accessible status badges
- "Start New Training" CTA is prominent and navigates to /training
- Seed script populates database with 15-20 realistic training jobs
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-and-welcome/02-01-SUMMARY.md`
</output>
