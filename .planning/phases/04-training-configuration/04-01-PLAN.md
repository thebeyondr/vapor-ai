---
phase: 04-training-configuration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/db/schema.ts
  - lib/validations/training-job.ts
autonomous: true

must_haves:
  truths:
    - "trainingJobs schema includes batchSize column"
    - "Zod validation schema enforces realistic hyperparameter ranges"
    - "react-hook-form and @hookform/resolvers are installed"
    - "ShadCN form, label, and select components are available"
  artifacts:
    - path: "lib/db/schema.ts"
      provides: "trainingJobs table with batchSize column"
      contains: "batchSize"
    - path: "lib/validations/training-job.ts"
      provides: "Shared Zod schema for training job form"
      exports: ["trainingJobSchema", "TrainingJobInput"]
  key_links:
    - from: "lib/validations/training-job.ts"
      to: "lib/db/schema.ts"
      via: "field names match DB columns"
      pattern: "batchSize|learningRate|epochs|modelName"
---

<objective>
Add batchSize column to database schema, install form dependencies, create shared Zod validation schema, and add ShadCN form components.

Purpose: Foundation for the training configuration form — schema, validation, and UI primitives must exist before the form can be built.
Output: Updated DB schema, validation module, installed dependencies and ShadCN components.
</objective>

<execution_context>
@/home/wraith/.claude/get-shit-done/workflows/execute-plan.md
@/home/wraith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-training-configuration/04-RESEARCH.md
@lib/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add batchSize column, install deps, add ShadCN components</name>
  <files>lib/db/schema.ts, package.json</files>
  <action>
1. Update `lib/db/schema.ts`:
   - Add `batchSize: integer("batch_size").notNull().default(16)` to trainingJobs table
   - Add `.$onUpdate(() => new Date())` to the updatedAt column for automatic timestamp updates
   - Update default values to match research recommendations: epochs default to 3, learningRate default to 0.0002

2. Push schema change to Neon:
   ```bash
   fnm use 22.19.0 && pnpm db:push
   ```

3. Install missing npm dependencies:
   ```bash
   pnpm add react-hook-form @hookform/resolvers
   ```

4. Add ShadCN form components (form includes label automatically):
   ```bash
   pnpm dlx shadcn@latest add form select
   ```
   Note: This will install `@radix-ui/react-label` and `@radix-ui/react-select` as needed.
  </action>
  <verify>
- `pnpm build` compiles without errors
- `grep -q "batchSize" lib/db/schema.ts` confirms column added
- `grep -q "react-hook-form" package.json` confirms dependency
- `ls components/ui/form.tsx components/ui/select.tsx` confirms ShadCN components
  </verify>
  <done>batchSize column exists in schema, react-hook-form + resolvers installed, ShadCN form/select/label components available</done>
</task>

<task type="auto">
  <name>Task 2: Create shared Zod validation schema for training jobs</name>
  <files>lib/validations/training-job.ts</files>
  <action>
Create `lib/validations/training-job.ts` with:

1. `hyperparameterRanges` const object with min/max/recommended/description for learningRate, epochs, batchSize — used for both validation and UI hints.

2. `trainingJobSchema` Zod object:
   - `name`: string, min 3, max 100, meaningful error messages
   - `modelId`: string, min 1 ("Please select a base model")
   - `learningRate`: number, min 1e-6, max 1.0, must be positive
   - `epochs`: number, int, min 1, max 100
   - `batchSize`: number, int, min 1, max 128, refine to require power of 2

3. Export `type TrainingJobInput = z.infer<typeof trainingJobSchema>`

Use Zod v4 syntax (already installed as ^4.3.6). Import as `import { z } from "zod"`.

Reference the research RESEARCH.md Pattern 1 for exact field definitions and error messages.
  </action>
  <verify>
- File exists at `lib/validations/training-job.ts`
- `pnpm build` compiles without errors
- TypeScript types resolve correctly (no type errors)
  </verify>
  <done>Shared Zod schema exports trainingJobSchema and TrainingJobInput type with realistic ML hyperparameter validation ranges</done>
</task>

</tasks>

<verification>
- `pnpm build` passes (schema, validation, and deps all compatible)
- `lib/db/schema.ts` has batchSize column
- `lib/validations/training-job.ts` exports schema and type
- ShadCN form components exist in `components/ui/`
</verification>

<success_criteria>
Database schema updated with batchSize, Zod validation schema created with realistic hyperparameter ranges, all form dependencies installed and ShadCN components available.
</success_criteria>

<output>
After completion, create `.planning/phases/04-training-configuration/04-01-SUMMARY.md`
</output>
